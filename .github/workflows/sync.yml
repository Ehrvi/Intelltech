name: Auto-Sync to Google Drive

on:
  push:
    branches: [main]
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:  # Manual trigger

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Install rclone
        run: |
          curl https://rclone.org/install.sh | sudo bash
          rclone version
      
      - name: Configure rclone
        run: |
          echo "${{ secrets.RCLONE_CONFIG }}" > ~/.rclone.conf
          rclone listremotes
      
      - name: Sync to Google Drive
        run: |
          rclone sync . manus_google_drive:Manus_Knowledge/ \
            --exclude .git/ \
            --exclude .github/ \
            --exclude __pycache__/ \
            --exclude "*.pyc" \
            --exclude .DS_Store \
            --progress \
            --log-level INFO
      
      - name: Verify sync
        run: |
          echo "Sync completed successfully!"
          rclone ls manus_google_drive:Manus_Knowledge/ | head -20
